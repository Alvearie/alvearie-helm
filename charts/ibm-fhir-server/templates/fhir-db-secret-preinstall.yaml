apiVersion: v1
kind: Secret
metadata:
  name: {{ template "fhir.fullname" . }}-db-secret-preinstall
  labels:
    app: {{ template "fhir.name" . }}
    chart: {{ .Chart.Name }}-{{ .Chart.Version }}
    release: {{ .Release.Name }}
    heritage: {{ .Release.Service }}
  annotations:
    # This is what defines this resource as a hook. Without this line, the
    # job is considered part of the release.
    "helm.sh/hook": pre-install,pre-upgrade
    # Hook weights can be positive or negative numbers but must be represented as strings.
    # When Helm starts the execution cycle of hooks of a particular Kind it will sort those hooks in ascending order.
    # So make sure this number is lower than the create-schema weight.
    "helm.sh/hook-weight": "0"
    "helm.sh/hook-delete-policy": before-hook-creation,hook-succeeded
type: Opaque
data:
  {{- if .Values.db.password }}
  password: {{ .Values.db.password | b64enc }}
  {{- end }}
  {{- if .Values.db.apiKey }}
  apiKey: {{ .Values.db.apiKey | b64enc }}
  {{- end }}
